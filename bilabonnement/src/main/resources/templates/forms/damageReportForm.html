<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Skadesrapport</title>
    <link rel="stylesheet" th:href="@{/css/forms/damageReportForm.css}">
</head>

<body>

<div class="page-wrapper">

    <!-- TOP HEADER MATCHER FORM WIDTH -->
    <div class="top-header">Skadesrapport</div>

    <form th:action="@{/damage-report/save}"
          th:object="${damageReport}"
          method="post"
          class="damage-form">

        <!-- TOP INPUTS -->
        <div class="input-wrapper">
            <span>Lejekontrakt ID</span>
            <input type="text" th:field="*{leasingContractId}">
        </div>

        <div class="input-wrapper">
            <span>Dato for rapport</span>
            <input type="date" th:field="*{reportDate}">
        </div>

        <div class="input-wrapper">
            <span>Dato for returnering</span>
            <input type="date" th:field="*{returnDate}">
        </div>

        <div class="input-wrapper">
            <span>Kilometertal</span>
            <input type="number" th:field="*{totalKm}">
        </div>

        <!-- SKADER-SEKTION MED RAMME -->
        <div class="damage-section-box">
            <h3 class="damage-title">Skader</h3>

            <div class="damage-list"
                 th:each="item, iter : *{damageItems}">

                <div class="damage-row">

                    <!-- ID -->
                    <div class="damage-field id">
                        <label>ID</label>
                        <input type="text" th:value="${iter.index + 1}" readonly>
                    </div>

                    <!-- DESCRIPTION -->
                    <div class="damage-field description">
                        <label>Beskrivelse</label>
                        <input type="text" th:field="*{damageItems[__${iter.index}__].description}">
                    </div>

                    <!-- PRICE -->
                    <div class="damage-field price">
                        <label>Pris</label>
                        <input type="number"
                               th:field="*{damageItems[__${iter.index}__].damageItemPrice}"
                               min="0" step="0.01">
                    </div>

                    <!-- MINUS / SLET KNAP -->
                    <button type="button"
                            class="remove-btn"
                            onclick="removeDamageRow(this)">−</button>

                </div>
            </div>

            <button class="add-btn" type="button" onclick="addDamageItem()">+</button>

            <div class="input-wrapper">
                <span>Pris (skader)</span>
                <input type="number" th:field="*{totalDamagePrice}" readonly>
            </div>
        </div>

        <!-- TOTAL -->
        <div class="input-wrapper">
            <span>Pris i alt</span>
            <input type="number" th:field="*{totalPrice}">
        </div>

        <!-- PAYED? -->
        <div class="paid-section">
            <label>Betalt?</label>
            <label><input type="radio" th:field="*{hasPayed}" value="true"> Ja</label>
            <label><input type="radio" th:field="*{hasPayed}" value="false"> Nej</label>
        </div>


    </form>

    <!-- ACTION BUTTONS UDENFOR FORM -->
    <div class="action-buttons">
        <button class="back">Tilbage</button>
        <button class="save">Gem</button>
        <button class="send">Send</button>
    </div>

</div>

<script>
    function addDamageItem() {
        const list = document.querySelector(".damage-section-box .damage-list");
        const index = list ? list.parentElement.querySelectorAll(".damage-row").length : 0;
        const number = index + 1;

        // Hvis der ikke findes en .damage-list endnu (fx helt tom liste)
        let container = list;
        if (!container) {
            const box = document.querySelector(".damage-section-box");
            container = document.createElement("div");
            container.className = "damage-list";
            box.insertBefore(container, box.querySelector(".add-btn"));
        }

        const template = `
            <div class="damage-row">

                <div class="damage-field id">
                    <label>ID</label>
                    <input type="text" value="${number}" readonly>
                </div>

                <div class="damage-field description">
                    <label>Beskrivelse</label>
                    <input type="text" name="damageItems[${index}].description">
                </div>

                <div class="damage-field price">
                    <label>Pris</label>
                    <input type="number" name="damageItems[${index}].damageItemPrice" min="0" step="0.01">
                </div>

                <button type="button"
                        class="remove-btn"
                        onclick="removeDamageRow(this)">−</button>

            </div>
        `;

        container.insertAdjacentHTML("beforeend", template);
    }

    function removeDamageRow(button) {
        const row = button.closest(".damage-row");
        if (!row) return;

        row.remove();

        // OPTIONAL: reindex IDs visuelt efter sletning
        const rows = document.querySelectorAll(".damage-row");
        rows.forEach((r, i) => {
            const idInput = r.querySelector(".damage-field.id input");
            if (idInput) {
                idInput.value = i + 1;
            }
        });
    }
</script>

</body>
</html>
